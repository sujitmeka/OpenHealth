{
  "branchName": "main",
  "projectName": "healthai",
  "sprintFocus": "Digital Twin 3D Model - Clean Mannequin",
  "designReference": "Clean white mannequin like store displays. Smooth, minimal, elegant. No visible joints or gaps. Subtle anatomical form without detail.",
  "userStories": [
    {
      "id": "DT-001",
      "title": "Install Three.js dependencies",
      "acceptanceCriteria": [
        "three package installed",
        "@react-three/fiber package installed",
        "@react-three/drei package installed",
        "@types/three installed for TypeScript",
        "npm run dev still works without errors",
        "typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "npm install three @react-three/fiber @react-three/drei && npm install -D @types/three"
    },
    {
      "id": "DT-002",
      "title": "Three.js canvas with studio lighting",
      "acceptanceCriteria": [
        "components/digital-twin/TwinCanvas.tsx exists",
        "Canvas renders with soft gradient background (light gray #f0f0f0 to white)",
        "Three-point lighting setup for soft shadows and depth",
        "Main light from upper-front-right",
        "Fill light from left (dimmer)",
        "Rim light from behind (subtle edge definition)",
        "OrbitControls with limited vertical rotation (don't go underground)",
        "Camera at eye level, 3-4 units back",
        "typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Studio lighting makes the mannequin look professional. Use directionalLight for main, ambientLight for fill."
    },
    {
      "id": "DT-003",
      "title": "Anatomical proportions constants",
      "acceptanceCriteria": [
        "lib/digital-twin/proportions.ts exists",
        "BODY_PROPORTIONS constant exported",
        "Uses 'head units' system where 1 head = 0.28 world units",
        "Total height: 7.5 heads = 2.1 world units",
        "Head height: 0.28, width: 0.20",
        "Neck height: 0.08, radius: 0.06",
        "Torso height: 0.70, shoulder width: 0.45, waist width: 0.30, hip width: 0.35",
        "Upper arm length: 0.36, radius: 0.045 to 0.035",
        "Forearm length: 0.30, radius: 0.035 to 0.025",
        "Hand length: 0.18, width: 0.08",
        "Thigh length: 0.50, radius: 0.065 to 0.045",
        "Shin length: 0.48, radius: 0.045 to 0.03",
        "Foot length: 0.25, width: 0.09, height: 0.06",
        "typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "All body parts will reference these constants. Ensures consistent proportions. These create a ~2.1 unit tall figure."
    },
    {
      "id": "DT-004",
      "title": "Smooth tapered limb geometry",
      "acceptanceCriteria": [
        "lib/digital-twin/geometry.ts exists",
        "createTaperedCapsule(length, radiusTop, radiusBottom, capSegments, radialSegments) exported",
        "Creates smooth tapered cylinder with hemisphere end caps",
        "Minimum 16 radial segments for smoothness",
        "Geometry is centered on Y axis",
        "Returns BufferGeometry ready to use",
        "typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Combine CylinderGeometry with SphereGeometry halves. Or use LatheGeometry with custom profile for smoother result."
    },
    {
      "id": "DT-005",
      "title": "Mannequin material system",
      "acceptanceCriteria": [
        "lib/digital-twin/materials.ts exists",
        "createBaseMaterial() returns clean matte white MeshStandardMaterial",
        "Color: #fafafa (warm white)",
        "Roughness: 0.85 (matte, not shiny)",
        "Metalness: 0",
        "createHighlightMaterial(color, intensity) returns glowing variant",
        "Materials are reusable across body parts",
        "typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Base material is shared. Highlight material clones base and adds emissive."
    },
    {
      "id": "DT-006",
      "title": "Torso with anatomical shape",
      "acceptanceCriteria": [
        "components/digital-twin/body-parts/Torso.tsx exists",
        "NOT a simple cylinder - has shape",
        "Wider at shoulders, narrower at waist, slightly wider at hips",
        "Use LatheGeometry with profile points defining silhouette",
        "Profile: shoulder → ribcage → waist (narrowest) → hip",
        "Smooth curves, no hard angles",
        "Height and widths match BODY_PROPORTIONS",
        "Centered at origin, bottom at Y=0 (hip level)",
        "Accepts ref and highlight props",
        "typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "LatheGeometry takes array of Vector2 points and rotates around Y axis. Define half-silhouette from center to edge."
    },
    {
      "id": "DT-007",
      "title": "Head with subtle oval shape",
      "acceptanceCriteria": [
        "components/digital-twin/body-parts/Head.tsx exists",
        "Oval shape - slightly taller than wide (scale Y: 1.15)",
        "Subtle taper toward jaw (narrower at bottom)",
        "Use scaled SphereGeometry OR LatheGeometry for egg shape",
        "Size matches BODY_PROPORTIONS",
        "Positioned on top of neck seamlessly",
        "No visible seam/gap",
        "typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "SphereGeometry with scale [1, 1.15, 1] gives nice oval. Or custom LatheGeometry for more control."
    },
    {
      "id": "DT-008",
      "title": "Neck connecting head and torso",
      "acceptanceCriteria": [
        "components/digital-twin/body-parts/Neck.tsx exists",
        "Smooth tapered cylinder (slightly wider at base)",
        "Top overlaps into head mesh slightly",
        "Bottom overlaps into torso mesh slightly",
        "No visible seams",
        "Proportions from BODY_PROPORTIONS",
        "typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Overlapping meshes into each other hides seams. Position neck to penetrate 10-15% into both head and torso."
    },
    {
      "id": "DT-009",
      "title": "Arm with smooth shoulder connection",
      "acceptanceCriteria": [
        "components/digital-twin/body-parts/Arm.tsx exists",
        "Props: side ('left' | 'right'), highlight",
        "Shoulder is rounded sphere that overlaps into torso edge",
        "Upper arm tapers from shoulder to elbow",
        "Small sphere at elbow for smooth joint",
        "Forearm tapers from elbow to wrist",
        "Hand is simple rounded shape (mitten style)",
        "Natural resting angle: 5-8 degrees away from body",
        "Hierarchy: shoulder → upperArm → forearm → hand as nested groups",
        "Left/right properly mirrored",
        "typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Shoulder sphere position: at torso edge, slightly in front. Arm rests with slight outward angle, hands at thigh level."
    },
    {
      "id": "DT-010",
      "title": "Leg with natural stance",
      "acceptanceCriteria": [
        "components/digital-twin/body-parts/Leg.tsx exists",
        "Props: side ('left' | 'right'), highlight",
        "Hip joint is sphere that overlaps into torso bottom",
        "Thigh tapers from hip to knee",
        "Small sphere at knee for smooth joint",
        "Shin tapers from knee to ankle",
        "Foot is wedge shape, flat bottom on ground (Y=0)",
        "Stance: feet hip-width apart (~0.25 units between feet)",
        "Feet angle outward 10-15 degrees",
        "Hierarchy: hip → thigh → shin → foot as nested groups",
        "typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Ground is Y=0. Foot bottom flat at Y=0. Total leg height from hip to ground matches proportions."
    },
    {
      "id": "DT-011",
      "title": "Assemble complete mannequin",
      "acceptanceCriteria": [
        "components/digital-twin/ProceduralHuman.tsx assembles all parts",
        "Imports: Torso, Head, Neck, Arm, Leg",
        "All parts positioned correctly",
        "NO visible gaps between parts",
        "NO overlapping artifacts (z-fighting)",
        "Figure centered at X=0, Z=0",
        "Figure stands on Y=0 ground",
        "Total height ~2.1 units",
        "Looks like clean store mannequin",
        "Props: bodyState (for posture/highlights)",
        "typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Assembly and fine-tuning. Adjust positions until seams are invisible. This is critical for clean look."
    },
    {
      "id": "DT-012",
      "title": "Body state types",
      "acceptanceCriteria": [
        "lib/digital-twin/types.ts exists",
        "BodyState interface with: posture, highlights[], energyLevel, skinTone",
        "PostureState: 'upright' | 'neutral' | 'slouched' | 'fatigued'",
        "HighlightRegion: { part: string, color: string, intensity: number }",
        "EnergyLevel: 0-100",
        "ProceduralHuman accepts bodyState prop",
        "typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Interface separates health logic from 3D rendering."
    },
    {
      "id": "DT-013",
      "title": "Health to body state mapper",
      "acceptanceCriteria": [
        "lib/digital-twin/mapper.ts exists",
        "mapHealthToBodyState(healthData) exported",
        "Sleep < 60 → energy 30, posture 'fatigued'",
        "Sleep 60-80 → energy 60, posture 'slouched'",
        "Sleep > 80 → energy 85, posture 'upright'",
        "HRV modifies energy (+/- 10)",
        "Visceral fat > 1.5 → highlight torso (orange #ff6b35)",
        "CRP > 2 → highlight joints (red #ff4444)",
        "Returns complete BodyState",
        "typecheck passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Simple thresholds. Health data → BodyState → visual representation."
    },
    {
      "id": "DT-014",
      "title": "Posture rotations system",
      "acceptanceCriteria": [
        "lib/digital-twin/posture.ts exists",
        "getPostureRotations(postureState, energyLevel) exported",
        "Returns object with rotation values in radians",
        "Upright: spine 0, neck 0, shoulders 0",
        "Neutral: spine 0.05, neck 0.03, shoulders 0.02",
        "Slouched: spine 0.12, neck 0.08, shoulders 0.06 (rolled forward)",
        "Fatigued: spine 0.18, neck 0.12, shoulders 0.08",
        "Body parts apply these rotations",
        "typecheck passes"
      ],
      "priority": 14,
      "passes": true,
      "notes": "Spine rotates on X axis (forward bend). Shoulders rotate inward when tired. Keep subtle - not exaggerated."
    },
    {
      "id": "DT-015",
      "title": "Highlight glow effect",
      "acceptanceCriteria": [
        "Body parts accept highlight prop",
        "When highlighted: material has emissive glow",
        "Highlight color configurable (default orange #ff6b35)",
        "Intensity 0.3-0.6 range (visible but not overwhelming)",
        "Non-highlighted parts stay clean white",
        "Multiple parts can be highlighted simultaneously",
        "typecheck passes"
      ],
      "priority": 15,
      "passes": true,
      "notes": "Use useMemo to create highlight materials. Apply based on bodyState.highlights array."
    },
    {
      "id": "DT-016",
      "title": "Skin tone from vitality",
      "acceptanceCriteria": [
        "lib/digital-twin/vitality.ts exists",
        "getVitalityColor(energyLevel) exported",
        "Energy 80+: warm white #fffaf5",
        "Energy 50-80: neutral #fafafa",
        "Energy <50: cool gray #f0f0f5",
        "Smooth interpolation between values",
        "Applied as base material color",
        "typecheck passes"
      ],
      "priority": 16,
      "passes": true,
      "notes": "Subtle effect. Use THREE.Color.lerp for smooth transitions."
    },
    {
      "id": "DT-017",
      "title": "Connect to health data store",
      "acceptanceCriteria": [
        "components/digital-twin/DigitalTwin.tsx wrapper exists",
        "Reads health data from HealthDataStore",
        "Calls mapHealthToBodyState",
        "Passes bodyState to ProceduralHuman",
        "Twin reflects real health metrics",
        "Updates when store data changes",
        "typecheck passes"
      ],
      "priority": 17,
      "passes": true,
      "notes": "This wires everything together."
    },
    {
      "id": "DT-018",
      "title": "Dashboard integration",
      "acceptanceCriteria": [
        "Digital twin on main dashboard page",
        "Layout: twin left (45%), stats right (55%)",
        "Twin container min-height 450px",
        "Canvas fills container",
        "No layout shift on load",
        "Matches dashboard design style",
        "typecheck passes"
      ],
      "priority": 18,
      "passes": true,
      "notes": "Canvas needs explicit height. Use aspect-ratio or fixed height."
    },
    {
      "id": "DT-019",
      "title": "Smooth posture transitions",
      "acceptanceCriteria": [
        "Posture changes animate over 0.6 seconds",
        "Use useFrame with lerp",
        "Current rotation lerps toward target",
        "Highlight intensity fades in/out",
        "Skin color transitions smoothly",
        "No jarring snaps",
        "typecheck passes"
      ],
      "priority": 19,
      "passes": true,
      "notes": "Store target values in state, interpolate current toward target each frame."
    },
    {
      "id": "DT-020",
      "title": "Idle breathing animation",
      "acceptanceCriteria": [
        "Torso scale oscillates subtly (1.0 to 1.012)",
        "4-second breathing cycle",
        "Use Math.sin(time * 0.5) for smooth wave",
        "Optional slight weight shift",
        "Feels alive but subtle",
        "typecheck passes"
      ],
      "priority": 20,
      "passes": true,
      "notes": "Very subtle. Should feel natural, not robotic."
    },
    {
      "id": "DT-021",
      "title": "Ground contact shadow",
      "acceptanceCriteria": [
        "Soft shadow beneath figure",
        "Use ContactShadows from drei",
        "Opacity 0.3-0.4 (soft, not harsh)",
        "Blur 2-3",
        "Grounds figure visually",
        "Matches clean aesthetic",
        "typecheck passes"
      ],
      "priority": 21,
      "passes": true,
      "notes": "ContactShadows is simplest. Position at Y=0."
    },
    {
      "id": "DT-022",
      "title": "Click for body part details",
      "acceptanceCriteria": [
        "Body parts have onClick handlers",
        "Click torso → tooltip shows visceral fat, body fat %",
        "Click arm/leg joints → tooltip shows CRP",
        "Click head → tooltip shows sleep, energy level",
        "Tooltip positioned near click point",
        "Use Html from drei for tooltips",
        "Click away dismisses tooltip",
        "typecheck passes"
      ],
      "priority": 22,
      "passes": true,
      "notes": "Each mesh gets onClick. Show tooltip as Html element in 3D space."
    },
    {
      "id": "DT-023",
      "title": "Final polish",
      "acceptanceCriteria": [
        "No console errors/warnings",
        "60fps performance",
        "Responsive to viewport changes",
        "Suspense fallback for loading",
        "Mannequin looks professional",
        "All health features work correctly",
        "typecheck passes"
      ],
      "priority": 23,
      "passes": true,
      "notes": "Final QA pass. Test all viewport sizes."
    }
  ]
}
