{
  "branchName": "main",
  "projectName": "healthai",
  "sprintFocus": "Dashboard Components - AI Chat Bar + Data Freshness + Top 5 Markers + Lifestyle Summary",
  "designReference": "Modern health dashboard. AI-first experience with chat bar at top. Clean, minimal, functional.",
  "userStories": [
    {
      "id": "DASH-001",
      "title": "AI Chat Bar - Collapsed State",
      "acceptanceCriteria": [
        "components/ai-chat/ChatBar.tsx exists",
        "Rounded pill-shaped bar, full width with horizontal padding",
        "Soft shadow (shadow-md or similar)",
        "Left: AI sparkle/brain icon",
        "Center: Placeholder text 'Ask anything about your health...'",
        "Right: 2-3 contextual pill buttons (styled as small rounded buttons)",
        "Pill buttons are clickable and will trigger chat expansion",
        "Clicking anywhere on bar triggers expansion",
        "Uses design tokens for colors (not hardcoded)",
        "typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "This is the collapsed default state. Just the visual - expansion logic comes next."
    },
    {
      "id": "DASH-002",
      "title": "AI Chat Bar - Contextual Pills Logic",
      "acceptanceCriteria": [
        "lib/ai-chat/generateContextualPills.ts exists",
        "Function takes biomarker data as input",
        "Returns array of 2-3 suggested questions",
        "If any markers out of range: generates questions like 'Why is my [marker] [value]?'",
        "Prioritizes ApoB and HbA1c if they are out of range",
        "If all optimal: returns questions like 'What's keeping me healthy?' or 'What should I test next?'",
        "Questions are concise (under 30 characters ideally)",
        "typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Smart question generation based on user's actual data. Import biomarker data from existing store."
    },
    {
      "id": "DASH-003",
      "title": "AI Chat Bar - Expanded State",
      "acceptanceCriteria": [
        "components/ai-chat/ChatModal.tsx exists",
        "Modal slides down from ChatBar position",
        "Background behind modal is blurred (backdrop-blur-sm or similar)",
        "Semi-transparent dark overlay on background",
        "Chat interface inside modal: message list + input field",
        "Close button (X) in top right of modal",
        "Clicking outside modal closes it",
        "ESC key closes modal",
        "Modal is centered, max-width ~600px, max-height ~70vh",
        "typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Focus on the UI/UX of expansion. Actual AI responses come later."
    },
    {
      "id": "DASH-004",
      "title": "AI Chat Bar - State Management",
      "acceptanceCriteria": [
        "ChatBar and ChatModal share state via React context or zustand",
        "isExpanded boolean controls collapsed/expanded",
        "messages array stores chat history",
        "Clicking ChatBar or pill sets isExpanded=true",
        "Clicking pill also pre-fills input with that question",
        "Close button or outside click sets isExpanded=false",
        "Chat history persists when closing/reopening modal",
        "typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "State management for chat. Can use zustand store or React context."
    },
    {
      "id": "DASH-005",
      "title": "AI Chat Bar - Basic AI Response",
      "acceptanceCriteria": [
        "lib/ai-chat/chatWithAI.ts exists",
        "Function sends message to /api/chat endpoint",
        "API route calls Anthropic Claude API",
        "System prompt includes user's biomarker data as context",
        "Streaming response displayed in chat",
        "Loading state shown while waiting",
        "Error handling if API fails",
        "Uses ANTHROPIC_API_KEY from environment",
        "typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Wire up actual AI. System prompt should include relevant health data so AI can give personalized answers."
    },
    {
      "id": "DASH-006",
      "title": "Data Freshness Indicator",
      "acceptanceCriteria": [
        "components/dashboard/DataFreshnessBar.tsx exists",
        "Horizontal bar below AI chat bar",
        "Shows data sources with last updated time",
        "Format: 'Blood work: 3 days ago | Whoop: 2 hrs ago | DEXA: 45 days ago'",
        "Uses relative time (moment.js, date-fns, or similar)",
        "Fresh data (<7 days): normal text color",
        "Stale data (>30 days): yellow/amber warning color",
        "Very stale (>90 days): red color with 'Retest recommended' badge",
        "Pulls last-updated timestamps from data store",
        "Subtle styling - not too prominent",
        "typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Helps user know if their data is current. Nudges retesting when stale."
    },
    {
      "id": "DASH-007",
      "title": "Top 5 Personalized Markers - Component",
      "acceptanceCriteria": [
        "components/dashboard/TopMarkersCard.tsx exists",
        "Card with title 'Key Markers' or 'Markers to Watch'",
        "Shows exactly 5 biomarkers in a list",
        "Each row: marker name, value with unit, status indicator (color dot or badge)",
        "Status colors use design tokens (green/yellow/pink)",
        "Compact layout - fits in dashboard grid",
        "Clicking a marker could link to full biomarkers page (optional)",
        "typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Visual component. Selection logic is separate."
    },
    {
      "id": "DASH-008",
      "title": "Top 5 Personalized Markers - Selection Logic",
      "acceptanceCriteria": [
        "lib/biomarkers/selectTopMarkers.ts exists",
        "Function takes all biomarkers as input, returns top 5",
        "Always includes ApoB (fixed)",
        "Always includes HbA1c (fixed)",
        "Remaining 3 slots: AI-ranked by clinical significance",
        "Prioritizes out-of-range markers with high health impact",
        "Deprioritizes obscure markers (e.g., indirect bilirubin) even if out of range",
        "Has a LONGEVITY_PRIORITY list: hs-CRP, Vitamin D, LDL-C, HDL-C, triglycerides, fasting insulin, homocysteine",
        "If marker is out of range AND in priority list, it ranks higher",
        "Returns array of 5 marker objects with name, value, unit, status",
        "typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Hybrid logic: 2 fixed + 3 intelligently selected. Not just 'worst 5' - clinically relevant worst."
    },
    {
      "id": "DASH-009",
      "title": "Weekly Lifestyle Summary - Component",
      "acceptanceCriteria": [
        "components/dashboard/WeeklyLifestyleCard.tsx exists",
        "Card with title 'This Week' or 'Weekly Summary'",
        "Shows 4 metrics in grid or row layout",
        "Sleep Consistency: percentage with label",
        "HRV: number (ms) with label",
        "Strain: number with label",
        "Recovery: percentage with label",
        "Each metric has subtle icon",
        "Shows 'weekly average' subtext",
        "Placeholder/skeleton if no Whoop data connected",
        "typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Visual component for lifestyle data. Data fetching is separate."
    },
    {
      "id": "DASH-010",
      "title": "Weekly Lifestyle Summary - Data Integration",
      "acceptanceCriteria": [
        "lib/lifestyle/calculateWeeklySummary.ts exists",
        "Function takes 7 days of Whoop/activity data",
        "Calculates Sleep Consistency: % of nights within 30min of avg bedtime",
        "Calculates HRV: 7-day average",
        "Calculates Strain: 7-day average",
        "Calculates Recovery: 7-day average",
        "Handles missing days gracefully (uses available data)",
        "Returns object with all 4 metrics",
        "typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Aggregation logic for weekly stats. Assumes Whoop data is already in store."
    },
    {
      "id": "DASH-011",
      "title": "Dashboard Page Assembly",
      "acceptanceCriteria": [
        "app/(main)/dashboard/page.tsx updated",
        "Top: AI ChatBar component",
        "Below ChatBar: DataFreshnessBar",
        "Main grid layout with all components",
        "Includes: BiologicalAgeCard, BiomarkerSummary, TopMarkersCard, DigitalTwin, GoalsPreview, WeeklyLifestyleCard",
        "Responsive: stacks on mobile, grid on desktop",
        "Consistent spacing using design tokens",
        "All components pull from shared data stores",
        "Page loads without errors",
        "typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Final assembly. All components integrated into dashboard page."
    },
    {
      "id": "DASH-012",
      "title": "Chat Modal - Message Styling",
      "acceptanceCriteria": [
        "User messages aligned right, blue/primary background",
        "AI messages aligned left, gray/neutral background",
        "Messages have rounded corners",
        "Timestamps shown subtly below messages",
        "AI messages support markdown rendering (bold, lists, etc.)",
        "Smooth scroll to bottom on new message",
        "Loading indicator (typing dots) while AI responds",
        "typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Polish the chat UI to feel professional."
    }
  ]
}
