{
  "branchName": "main",
  "projectName": "healthai",
  "sprintFocus": "Digital Twin 3D Model",
  "userStories": [
    {
      "id": "DT-001",
      "title": "Install Three.js dependencies",
      "acceptanceCriteria": [
        "three package installed",
        "@react-three/fiber package installed",
        "@react-three/drei package installed",
        "@types/three installed for TypeScript",
        "npm run dev still works without errors",
        "typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "npm install three @react-three/fiber @react-three/drei && npm install -D @types/three"
    },
    {
      "id": "DT-002",
      "title": "Basic Three.js canvas component",
      "acceptanceCriteria": [
        "components/digital-twin/TwinCanvas.tsx exists",
        "Canvas component from @react-three/fiber renders",
        "Soft gray gradient background (like reference image)",
        "Basic lighting setup: ambient (soft) + directional (subtle shadows)",
        "OrbitControls allows user to rotate view",
        "Camera positioned to show full body",
        "Component renders without errors",
        "typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Start simple. Test with a Box mesh first to verify setup works."
    },
    {
      "id": "DT-003",
      "title": "Procedural human body - torso and head",
      "acceptanceCriteria": [
        "components/digital-twin/ProceduralHuman.tsx exists",
        "Torso rendered as elongated capsule or rounded box",
        "Head rendered as sphere on top of torso",
        "Neck connects head to torso",
        "All white/light gray material (like reference mannequin)",
        "Proportions look human-like",
        "Centered in scene",
        "typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Use CapsuleGeometry, SphereGeometry, CylinderGeometry from Three.js. Group them in a parent object."
    },
    {
      "id": "DT-004",
      "title": "Procedural human body - arms",
      "acceptanceCriteria": [
        "Left and right arms added to ProceduralHuman",
        "Upper arm (shoulder to elbow) as capsule",
        "Forearm (elbow to wrist) as capsule",
        "Hands as small spheres or boxes",
        "Arms positioned at sides naturally",
        "Shoulders connect to torso properly",
        "typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Use Three.js Groups for hierarchy: shoulder → upperArm → forearm → hand. This allows joint rotation later."
    },
    {
      "id": "DT-005",
      "title": "Procedural human body - legs",
      "acceptanceCriteria": [
        "Left and right legs added to ProceduralHuman",
        "Thigh (hip to knee) as capsule",
        "Shin (knee to ankle) as capsule",
        "Feet as flattened boxes or capsules",
        "Legs positioned under torso naturally",
        "Figure stands on ground plane",
        "Full body now visible and proportioned",
        "typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Hip joints connect to bottom of torso. Feet flat on Y=0 ground plane."
    },
    {
      "id": "DT-006",
      "title": "Body state types and interface",
      "acceptanceCriteria": [
        "lib/digital-twin/types.ts exists",
        "BodyState interface defined with: posture, highlights, skinTone, energyLevel",
        "PostureState type: 'upright' | 'slouched' | 'fatigued' | 'neutral'",
        "HighlightRegion type: { area: string, color: string, intensity: number }",
        "EnergyLevel: number 0-100",
        "ProceduralHuman accepts BodyState as props",
        "typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Clean interface separates health logic from rendering. Makes Option A swap easy later."
    },
    {
      "id": "DT-007",
      "title": "Health to body state mapper",
      "acceptanceCriteria": [
        "lib/digital-twin/mapper.ts exists",
        "mapHealthToBodyState(healthData) function exported",
        "Maps sleep score → energy level (low sleep = low energy)",
        "Maps HRV → posture (low HRV = more fatigued posture)",
        "Maps visceral fat → torso highlight (high = red/orange)",
        "Maps CRP → joint highlights (high inflammation = red joints)",
        "Maps body fat % → subtle shape hint",
        "Returns complete BodyState object",
        "typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Use simple thresholds. Example: sleepScore < 60 → energy = 30, sleepScore > 80 → energy = 90"
    },
    {
      "id": "DT-008",
      "title": "Posture system - joint rotations",
      "acceptanceCriteria": [
        "lib/digital-twin/posture.ts exists",
        "getPostureRotations(energyLevel, postureState) function exported",
        "Returns rotation values for: spine, neck, shoulders",
        "High energy: spine straight, head up, shoulders back",
        "Low energy: spine curved forward, head drooped, shoulders hunched",
        "Values in radians for Three.js rotation",
        "ProceduralHuman applies rotations to body part groups",
        "Visual difference is noticeable between states",
        "typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Spine rotation X: 0 (upright) to 0.3 (hunched). Neck: 0 to 0.2. Shoulders: rotate inward when tired."
    },
    {
      "id": "DT-009",
      "title": "Region highlighting system",
      "acceptanceCriteria": [
        "lib/digital-twin/highlights.ts exists",
        "Highlight regions defined: torso-core, left-shoulder, right-shoulder, left-knee, right-knee, left-hip, right-hip, head",
        "applyHighlights(bodyRef, highlights[]) function exported",
        "Changes material emissive color for highlighted regions",
        "Red/orange glow for problem areas",
        "Intensity controls glow strength",
        "No highlights = clean white material",
        "typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "MeshStandardMaterial has emissive and emissiveIntensity properties. Store refs to each body part mesh."
    },
    {
      "id": "DT-010",
      "title": "Skin tone and vitality visuals",
      "acceptanceCriteria": [
        "lib/digital-twin/vitality.ts exists",
        "getVitalityColor(energyLevel) function exported",
        "High energy: warm white/cream tone",
        "Low energy: cooler gray, slightly desaturated",
        "Applied as base material color to all body parts",
        "Subtle but visible difference",
        "typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "HSL color manipulation. High energy: hsl(30, 10%, 90%). Low energy: hsl(220, 5%, 80%)."
    },
    {
      "id": "DT-011",
      "title": "Wire digital twin to health data",
      "acceptanceCriteria": [
        "components/digital-twin/DigitalTwin.tsx exists as main wrapper",
        "Reads health data from HealthDataStore",
        "Calls mapHealthToBodyState with real data",
        "Passes BodyState to ProceduralHuman",
        "Twin reflects actual user health metrics",
        "Console logs current BodyState for debugging",
        "typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": "This connects everything. Health data → mapper → BodyState → ProceduralHuman renders it."
    },
    {
      "id": "DT-012",
      "title": "Integrate into dashboard layout",
      "acceptanceCriteria": [
        "Digital twin displays on main dashboard page",
        "Layout: twin takes ~40-50% width on left, stats on right",
        "Or: twin centered top, stats cards below",
        "Twin container has fixed aspect ratio (prevents layout shift)",
        "Minimum height of 400px for twin",
        "Works on desktop (mobile can stack)",
        "Page doesn't break or scroll weirdly",
        "typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Canvas needs explicit height. Use aspect-ratio CSS or fixed height container."
    },
    {
      "id": "DT-013",
      "title": "Smooth animation transitions",
      "acceptanceCriteria": [
        "Posture changes animate over 0.5-1 second (not instant)",
        "Use useFrame hook for lerp interpolation",
        "Highlight glows fade in/out smoothly",
        "Material color changes transition smoothly",
        "No jarring visual jumps",
        "typecheck passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Store target values in state, lerp current toward target in useFrame. THREE.MathUtils.lerp(current, target, delta * speed)"
    },
    {
      "id": "DT-014",
      "title": "Idle breathing animation",
      "acceptanceCriteria": [
        "Model has subtle idle animation when standing",
        "Slight chest/torso scale oscillation (breathing)",
        "Very subtle Y-axis sway or weight shift",
        "Animation is gentle, not distracting",
        "Runs continuously via useFrame",
        "typecheck passes"
      ],
      "priority": 14,
      "passes": true,
      "notes": "Use Math.sin(time) for oscillation. Breathing: scale torso 1.0 to 1.02. Sway: rotate Y +/- 0.01 radians."
    },
    {
      "id": "DT-015",
      "title": "Subtle ground shadow",
      "acceptanceCriteria": [
        "Soft shadow or reflection beneath the figure",
        "ContactShadows from drei OR simple gradient plane",
        "Grounds the figure visually",
        "Matches reference image aesthetic",
        "Performance is still smooth",
        "typecheck passes"
      ],
      "priority": 15,
      "passes": true,
      "notes": "drei ContactShadows is easiest. Or: circular plane mesh with radial gradient texture."
    },
    {
      "id": "DT-016",
      "title": "Status indicators overlay",
      "acceptanceCriteria": [
        "Small UI overlay on twin canvas showing key metrics",
        "Energy level as percentage or bar",
        "Number of highlighted areas",
        "Overall status: 'Optimal' / 'Fair' / 'Needs Attention'",
        "Positioned in corner, doesn't obscure model",
        "Uses Html component from drei for DOM in canvas",
        "typecheck passes"
      ],
      "priority": 16,
      "passes": true,
      "notes": "drei Html component renders DOM elements positioned in 3D space. Or overlay as sibling div with absolute positioning."
    },
    {
      "id": "DT-017",
      "title": "Click body region for details",
      "acceptanceCriteria": [
        "User can click on body region (torso, joints, etc)",
        "Clicked region shows tooltip with relevant health data",
        "Example: click torso → shows visceral fat value",
        "Example: click joints → shows CRP level",
        "Uses raycasting for click detection",
        "Tooltip positioned near clicked point",
        "typecheck passes"
      ],
      "priority": 17,
      "passes": false,
      "notes": "useThree hook gives access to raycaster. onClick on mesh, show Html tooltip. drei has Html component."
    },
    {
      "id": "DT-018",
      "title": "Final polish and responsive sizing",
      "acceptanceCriteria": [
        "Twin looks polished and professional",
        "Responsive: works at different viewport sizes",
        "No console errors or warnings",
        "Performance is smooth (60fps)",
        "Loading state while Three.js initializes",
        "Matches overall app aesthetic",
        "typecheck passes"
      ],
      "priority": 18,
      "passes": false,
      "notes": "Test at different sizes. Add Suspense fallback for loading. Check for memory leaks (dispose geometries)."
    }
  ]
}
